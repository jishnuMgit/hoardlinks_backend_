generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model agency_member {
  id                  BigInt                          @id @default(autoincrement())
  district_id         BigInt
  agency_code         String                          @unique(map: "agency_code") @db.VarChar(30)
  legal_name          String                          @db.VarChar(150)
  trade_name          String?                         @db.VarChar(150)
  contact_person      String                          @db.VarChar(100)
  contact_phone       String                          @db.VarChar(20)
  contact_email       String?                         @db.VarChar(120)
  address_line1       String?                         @db.VarChar(200)
  address_line2       String?                         @db.VarChar(200)
  city                String?                         @db.VarChar(80)
  pincode             String?                         @db.VarChar(10)
  gst_number          String?                         @db.VarChar(30)
  membership_status   agency_member_membership_status
  membership_start_dt DateTime?                       @db.Date
  membership_end_dt   DateTime?                       @db.Date
  created_at          DateTime                        @default(now()) @db.DateTime(0)
  updated_at          DateTime                        @default(now()) @db.DateTime(0)
  district_committee  district_committee              @relation(fields: [district_id], references: [id], onDelete: NoAction, map: "fk_agency_district")
  chitty_member       chitty_member[]
  committee_members   committee_members[]
  user_account        user_account[]

  @@index([district_id], map: "fk_agency_district")
}

model announcement {
  id                 BigInt              @id @default(autoincrement())
  level              announcement_level
  state_id           BigInt?
  district_id        BigInt?
  title              String              @db.VarChar(150)
  message            String              @db.Text
  valid_from         DateTime            @db.DateTime(0)
  valid_to           DateTime?           @db.DateTime(0)
  created_by_user    BigInt
  created_at         DateTime            @default(now()) @db.DateTime(0)
  district_committee district_committee? @relation(fields: [district_id], references: [id], map: "fk_announcement_district")
  state_committee    state_committee?    @relation(fields: [state_id], references: [id], map: "fk_announcement_state")
  user_account       user_account        @relation(fields: [created_by_user], references: [id], onDelete: NoAction, map: "fk_announcement_user")

  @@index([district_id], map: "fk_announcement_district")
  @@index([state_id], map: "fk_announcement_state")
  @@index([created_by_user], map: "fk_announcement_user")
}

model district_committee {
  id                BigInt                    @id @default(autoincrement())
  state_id          BigInt
  district_code     String                    @unique(map: "district_code") @db.VarChar(20)
  district_name     String                    @db.VarChar(100)
  contact_person    String?                   @db.VarChar(100)
  contact_phone     String?                   @db.VarChar(20)
  contact_email     String?                   @db.VarChar(120)
  status            district_committee_status
  created_at        DateTime                  @default(now()) @db.DateTime(0)
  updated_at        DateTime                  @default(now()) @db.DateTime(0)
  agency_member     agency_member[]
  announcement      announcement[]
  chitty_scheme     chitty_scheme[]
  committee_members committee_members[]
  state_committee   state_committee           @relation(fields: [state_id], references: [id], onDelete: NoAction, map: "fk_district_state")
  meeting_schedule  meeting_schedule[]
  user_account      user_account[]

  @@index([state_id], map: "fk_district_state")
}

model meeting_schedule {
  id                 BigInt                 @id @default(autoincrement())
  level              meeting_schedule_level
  state_id           BigInt?
  district_id        BigInt?
  title              String                 @db.VarChar(150)
  description        String?                @db.Text
  meeting_datetime   DateTime               @db.DateTime(0)
  venue              String?                @db.VarChar(200)
  created_by_user    BigInt
  created_at         DateTime               @default(now()) @db.DateTime(0)
  district_committee district_committee?    @relation(fields: [district_id], references: [id], map: "fk_meeting_district")
  state_committee    state_committee?       @relation(fields: [state_id], references: [id], map: "fk_meeting_state")
  user_account       user_account           @relation(fields: [created_by_user], references: [id], onDelete: NoAction, map: "fk_meeting_user")

  @@index([district_id], map: "fk_meeting_district")
  @@index([state_id], map: "fk_meeting_state")
  @@index([created_by_user], map: "fk_meeting_user")
}

model state_committee {
  id                 BigInt                 @id @default(autoincrement())
  state_code         String                 @unique(map: "state_code") @db.VarChar(20)
  state_name         String                 @db.VarChar(100)
  contact_person     String?                @db.VarChar(100)
  contact_phone      String?                @db.VarChar(20)
  contact_email      String?                @db.VarChar(120)
  status             state_committee_status
  created_at         DateTime               @default(now()) @db.DateTime(0)
  updated_at         DateTime               @default(now()) @db.DateTime(0)
  announcement       announcement[]
  chitty_scheme      chitty_scheme[]
  committee_members  committee_members[]
  district_committee district_committee[]
  meeting_schedule   meeting_schedule[]
  user_account       user_account[]
}

model user_account {
  id                 BigInt                 @id @default(autoincrement())
  login_id           String                 @unique(map: "login_id") @db.VarChar(80)
  password_hash      String                 @db.VarChar(255)
  mobile_number      String                 @db.VarChar(20)
  role_type          user_account_role_type
  state_id           BigInt?
  district_id        BigInt?
  agency_id          BigInt?
  firebaseUserKey    String                 @db.VarChar(50)
  FCM_token          String                 @db.VarChar(50)
  deviceType         String                 @db.VarChar(50)
  is_active          Boolean                @default(true)
  last_login_at      DateTime?              @db.DateTime(0)
  created_at         DateTime               @default(now()) @db.DateTime(0)
  updated_at         DateTime               @default(now()) @db.DateTime(0)
  announcement       announcement[]
  chitty_scheme      chitty_scheme[]
  meeting_schedule   meeting_schedule[]
  agency_member      agency_member?         @relation(fields: [agency_id], references: [id], map: "fk_user_agency")
  district_committee district_committee?    @relation(fields: [district_id], references: [id], map: "fk_user_district")
  state_committee    state_committee?       @relation(fields: [state_id], references: [id], map: "fk_user_state")

  @@index([agency_id], map: "fk_user_agency")
  @@index([district_id], map: "fk_user_district")
  @@index([state_id], map: "fk_user_state")
}

model cache {
  key        String @id
  value      String @db.MediumText
  expiration Int
}

model cache_locks {
  key        String @id
  owner      String
  expiration Int
}

model chitty_auction {
  id                 BigInt                    @id @default(autoincrement())
  chitty_id          BigInt
  cycle_id           BigInt
  event_type         chitty_auction_event_type
  event_datetime     DateTime                  @db.DateTime(0)
  status             chitty_auction_status     @default(SCHEDULED)
  notes              String?                   @db.Text
  created_at         DateTime                  @default(now()) @db.DateTime(0)
  updated_at         DateTime                  @default(now()) @db.DateTime(0)
  chitty_scheme      chitty_scheme             @relation(fields: [chitty_id], references: [id], onDelete: Cascade, map: "fk_chitty_auction_chitty")
  chitty_cycle       chitty_cycle              @relation(fields: [cycle_id], references: [id], onDelete: Cascade, map: "fk_chitty_auction_cycle")
  chitty_auction_bid chitty_auction_bid[]

  @@index([chitty_id], map: "idx_chitty_auction_chitty")
  @@index([cycle_id], map: "idx_chitty_auction_cycle")
}

model chitty_auction_bid {
  id             BigInt         @id @default(autoincrement())
  auction_id     BigInt
  member_id      BigInt
  bid_amount     Decimal        @db.Decimal(12, 2)
  bid_time       DateTime       @default(now()) @db.DateTime(0)
  is_winning_bid Boolean?       @default(false)
  created_at     DateTime       @default(now()) @db.DateTime(0)
  chitty_auction chitty_auction @relation(fields: [auction_id], references: [id], onDelete: Cascade, map: "fk_chitty_auction_bid_auction")
  chitty_member  chitty_member  @relation(fields: [member_id], references: [id], map: "fk_chitty_auction_bid_member")

  @@index([auction_id], map: "idx_chitty_auction_bid_auction")
  @@index([member_id], map: "idx_chitty_auction_bid_member")
}

model chitty_cycle {
  id                  BigInt                @id @default(autoincrement())
  chitty_id           BigInt
  cycle_no            Int
  cycle_start_date    DateTime              @db.Date
  due_date            DateTime              @db.Date
  payment_lock_date   DateTime?             @db.Date
  status              chitty_cycle_status   @default(NOT_STARTED)
  winner_member_id    BigInt?
  created_at          DateTime              @default(now()) @db.DateTime(0)
  updated_at          DateTime              @default(now()) @db.DateTime(0)
  chitty_auction      chitty_auction[]
  chitty_scheme       chitty_scheme         @relation(fields: [chitty_id], references: [id], onDelete: Cascade, map: "fk_chitty_cycle_chitty")
  chitty_member       chitty_member?        @relation(fields: [winner_member_id], references: [id], map: "fk_chitty_cycle_winner_member")
  chitty_ledger_entry chitty_ledger_entry[]
  chitty_payment      chitty_payment[]

  @@unique([chitty_id, cycle_no], map: "ux_chitty_cycle_chitty_cycleno")
  @@index([chitty_id], map: "idx_chitty_cycle_chitty")
  @@index([winner_member_id], map: "idx_chitty_cycle_winner")
}

model chitty_ledger_entry {
  id            BigInt                         @id @default(autoincrement())
  chitty_id     BigInt
  cycle_id      BigInt?
  member_id     BigInt?
  entry_type    chitty_ledger_entry_entry_type
  amount        Decimal                        @db.Decimal(12, 2)
  entry_date    DateTime                       @default(now()) @db.DateTime(0)
  reference_id  BigInt?
  remarks       String?                        @db.VarChar(250)
  created_at    DateTime                       @default(now()) @db.DateTime(0)
  chitty_scheme chitty_scheme                  @relation(fields: [chitty_id], references: [id], onDelete: Cascade, map: "fk_chitty_ledger_chitty")
  chitty_cycle  chitty_cycle?                  @relation(fields: [cycle_id], references: [id], map: "fk_chitty_ledger_cycle")
  chitty_member chitty_member?                 @relation(fields: [member_id], references: [id], map: "fk_chitty_ledger_member")

  @@index([chitty_id], map: "idx_chitty_ledger_chitty")
  @@index([cycle_id], map: "idx_chitty_ledger_cycle")
  @@index([member_id], map: "idx_chitty_ledger_member")
}

model chitty_member {
  id                  BigInt                    @id @default(autoincrement())
  chitty_id           BigInt
  agency_id           BigInt
  member_no           Int
  join_status         chitty_member_join_status @default(REQUESTED)
  join_date           DateTime?                 @db.Date
  exit_date           DateTime?                 @db.Date
  remarks             String?                   @db.VarChar(250)
  created_at          DateTime                  @default(now()) @db.DateTime(0)
  updated_at          DateTime                  @default(now()) @db.DateTime(0)
  chitty_auction_bid  chitty_auction_bid[]
  chitty_cycle        chitty_cycle[]
  chitty_ledger_entry chitty_ledger_entry[]
  agency_member       agency_member             @relation(fields: [agency_id], references: [id], map: "fk_chitty_member_agency")
  chitty_scheme       chitty_scheme             @relation(fields: [chitty_id], references: [id], onDelete: Cascade, map: "fk_chitty_member_chitty")
  chitty_payment      chitty_payment[]

  @@unique([chitty_id, member_no], map: "ux_chitty_member_chitty_memberno")
  @@index([agency_id], map: "idx_chitty_member_agency")
  @@index([chitty_id], map: "idx_chitty_member_chitty")
}

model chitty_payment {
  id            BigInt                       @id @default(autoincrement())
  chitty_id     BigInt
  cycle_id      BigInt
  member_id     BigInt
  amount_due    Decimal                      @default(0.00) @db.Decimal(12, 2)
  amount_paid   Decimal?                     @db.Decimal(12, 2)
  payment_date  DateTime?                    @db.DateTime(0)
  payment_mode  chitty_payment_payment_mode?
  status        chitty_payment_status        @default(PENDING)
  remarks       String?                      @db.VarChar(250)
  created_at    DateTime                     @default(now()) @db.DateTime(0)
  updated_at    DateTime                     @default(now()) @db.DateTime(0)
  chitty_scheme chitty_scheme                @relation(fields: [chitty_id], references: [id], onDelete: Cascade, map: "fk_chitty_payment_chitty")
  chitty_cycle  chitty_cycle                 @relation(fields: [cycle_id], references: [id], onDelete: Cascade, map: "fk_chitty_payment_cycle")
  chitty_member chitty_member                @relation(fields: [member_id], references: [id], map: "fk_chitty_payment_member")

  @@index([chitty_id], map: "idx_chitty_payment_chitty")
  @@index([cycle_id], map: "idx_chitty_payment_cycle")
  @@index([member_id], map: "idx_chitty_payment_member")
}

model chitty_scheme {
  id                  BigInt                   @id @default(autoincrement())
  scheme_code         String                   @unique(map: "ux_chitty_scheme_code") @db.VarChar(30)
  scheme_name         String                   @db.VarChar(150)
  frequency           chitty_scheme_frequency  @default(MONTHLY)
  level               chitty_scheme_level
  state_id            BigInt?
  district_id         BigInt?
  monthly_amount      Decimal                  @default(0.00) @db.Decimal(12, 2)
  amount              Decimal?                 @db.Decimal(12, 2)
  total_members       Int                      @default(0)
  duration_months     Int                      @default(0)
  start_date          DateTime                 @db.Date
  end_date            DateTime?                @db.Date
  lot_method          chitty_scheme_lot_method @default(LOT)
  status              chitty_scheme_status     @default(DRAFT)
  created_by_user     BigInt
  created_at          DateTime                 @default(now()) @db.DateTime(0)
  updated_at          DateTime                 @default(now()) @db.DateTime(0)
  chitty_auction      chitty_auction[]
  chitty_cycle        chitty_cycle[]
  chitty_ledger_entry chitty_ledger_entry[]
  chitty_member       chitty_member[]
  chitty_payment      chitty_payment[]
  user_account        user_account             @relation(fields: [created_by_user], references: [id], map: "fk_chitty_scheme_created_by_user")
  district_committee  district_committee?      @relation(fields: [district_id], references: [id], map: "fk_chitty_scheme_district")
  state_committee     state_committee?         @relation(fields: [state_id], references: [id], map: "fk_chitty_scheme_state")

  @@index([district_id], map: "fk_chitty_scheme_district")
  @@index([state_id], map: "fk_chitty_scheme_state")
  @@index([created_by_user], map: "fk_chitty_scheme_user")
  @@index([level], map: "idx_chitty_scheme_level")
  @@index([start_date], map: "idx_chitty_scheme_start_date")
}

model committee_members {
  id                    BigInt                           @id @default(autoincrement()) @db.UnsignedBigInt
  committee_type        committee_members_committee_type
  agency_member_id      BigInt
  district_committee_id BigInt?
  state_committee_id    BigInt?
  member_type_id        BigInt                           @db.UnsignedBigInt
  status                committee_members_status         @default(active)
  created_at            DateTime?                        @db.Timestamp(0)
  updated_at            DateTime?                        @db.Timestamp(0)
  agency_member         agency_member                    @relation(fields: [agency_member_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "committee_members_agency_member_id_foreign")
  district_committee    district_committee?              @relation(fields: [district_committee_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "committee_members_district_committee_id_foreign")
  member_types          member_types                     @relation(fields: [member_type_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "committee_members_member_type_id_foreign")
  state_committee       state_committee?                 @relation(fields: [state_committee_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "committee_members_state_committee_id_foreign")

  @@index([agency_member_id], map: "committee_members_agency_member_id_foreign")
  @@index([district_committee_id], map: "committee_members_district_committee_id_foreign")
  @@index([member_type_id], map: "committee_members_member_type_id_foreign")
  @@index([state_committee_id], map: "committee_members_state_committee_id_foreign")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model countries {
  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  name       String    @db.VarChar(100)
  code       String    @unique(map: "countries_code_unique") @db.VarChar(10)
  iso_code   String?   @db.VarChar(3)
  iso_code_2 String?   @db.VarChar(2)
  is_active  Boolean   @default(true)
  is_delete  Boolean   @default(false)
  created_at DateTime? @db.Timestamp(0)
  updated_at DateTime? @db.Timestamp(0)
  states     states[]

  @@index([code], map: "countries_code_index")
  @@index([is_active], map: "countries_is_active_index")
  @@index([is_delete], map: "countries_is_delete_index")
}

model districts {
  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  state_id   BigInt    @db.UnsignedBigInt
  name       String    @db.VarChar(100)
  code       String    @db.VarChar(50)
  is_active  Boolean   @default(true)
  is_delete  Boolean   @default(false)
  created_at DateTime? @db.Timestamp(0)
  updated_at DateTime? @db.Timestamp(0)
  states     states    @relation(fields: [state_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "districts_state_id_foreign")

  @@index([code], map: "districts_code_index")
  @@index([is_active], map: "districts_is_active_index")
  @@index([is_delete], map: "districts_is_delete_index")
  @@index([state_id], map: "districts_state_id_index")
}

model failed_jobs {
  id         BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  uuid       String   @unique(map: "failed_jobs_uuid_unique")
  connection String   @db.Text
  queue      String   @db.Text
  payload    String   @db.LongText
  exception  String   @db.LongText
  failed_at  DateTime @default(now()) @db.Timestamp(0)
}

model job_batches {
  id             String  @id
  name           String
  total_jobs     Int
  pending_jobs   Int
  failed_jobs    Int
  failed_job_ids String  @db.LongText
  options        String? @db.MediumText
  cancelled_at   Int?
  created_at     Int
  finished_at    Int?
}

model jobs {
  id           BigInt @id @default(autoincrement()) @db.UnsignedBigInt
  queue        String
  payload      String @db.LongText
  attempts     Int    @db.UnsignedTinyInt
  reserved_at  Int?   @db.UnsignedInt
  available_at Int    @db.UnsignedInt
  created_at   Int    @db.UnsignedInt

  @@index([queue], map: "jobs_queue_index")
}

model member_types {
  id                BigInt              @id @default(autoincrement()) @db.UnsignedBigInt
  name              String              @unique(map: "member_types_name_unique")
  slug              String              @unique(map: "member_types_slug_unique")
  description       String?             @db.Text
  sort_order        Int                 @default(0)
  status            member_types_status @default(active)
  created_at        DateTime?           @db.Timestamp(0)
  updated_at        DateTime?           @db.Timestamp(0)
  committee_members committee_members[]
}

model migrations {
  id        Int    @id @default(autoincrement()) @db.UnsignedInt
  migration String
  batch     Int
}

model sessions {
  id            String  @id
  user_id       BigInt? @db.UnsignedBigInt
  ip_address    String? @db.VarChar(45)
  user_agent    String? @db.Text
  payload       String  @db.LongText
  last_activity Int

  @@index([last_activity], map: "sessions_last_activity_index")
  @@index([user_id], map: "sessions_user_id_index")
}

model states {
  id         BigInt      @id @default(autoincrement()) @db.UnsignedBigInt
  country_id BigInt      @db.UnsignedBigInt
  name       String      @db.VarChar(100)
  code       String      @db.VarChar(50)
  is_active  Boolean     @default(true)
  is_delete  Boolean     @default(false)
  created_at DateTime?   @db.Timestamp(0)
  updated_at DateTime?   @db.Timestamp(0)
  districts  districts[]
  countries  countries   @relation(fields: [country_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "states_country_id_foreign")

  @@index([code], map: "states_code_index")
  @@index([country_id], map: "states_country_id_index")
  @@index([is_active], map: "states_is_active_index")
  @@index([is_delete], map: "states_is_delete_index")
}

enum announcement_level {
  STATE
  DISTRICT
}

enum meeting_schedule_level {
  STATE
  DISTRICT
}

enum user_account_role_type {
  STATE
  DISTRICT
  AGENCY
}

enum state_committee_status {
  ACTIVE
  INACTIVE
}

enum district_committee_status {
  ACTIVE
  INACTIVE
}

enum agency_member_membership_status {
  PENDING
  ACTIVE
  SUSPENDED
  CANCELLED
}

enum committee_members_committee_type {
  DISTRICT
  STATE
}

enum chitty_auction_event_type {
  LOT
  AUCTION
}

enum chitty_scheme_frequency {
  DAILY
  WEEKLY
  MONTHLY
}

enum chitty_ledger_entry_entry_type {
  CONTRIBUTION
  PAYOUT
  PENALTY
  ADJUSTMENT
}

enum chitty_member_join_status {
  REQUESTED
  APPROVED
  REJECTED
  ACTIVE
  EXITED
}

enum chitty_scheme_level {
  STATE
  DISTRICT
}

enum chitty_auction_status {
  SCHEDULED
  RUNNING
  COMPLETED
  CANCELLED
}

enum member_types_status {
  active
  inactive
}

enum chitty_cycle_status {
  NOT_STARTED
  OPEN
  PAYMENT_CLOSED
  AUCTION_DONE
  COMPLETED
}

enum committee_members_status {
  active
  inactive
}

enum chitty_payment_payment_mode {
  CASH
  BANK
  ONLINE
  OTHER
}

enum chitty_payment_status {
  PENDING
  PAID
  PARTIAL
  LATE
  WAIVED
}

enum chitty_scheme_lot_method {
  LOT
  AUCTION
  TABLE
}

enum chitty_scheme_status {
  DRAFT
  OPEN
  RUNNING
  CLOSED
  CANCELLED
}
